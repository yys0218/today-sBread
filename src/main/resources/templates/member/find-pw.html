<!-- member/find-pw.html -->
<!-- 비밀번호 찾기 페이지 -->
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta name="_csrf" th:content="${_csrf.token}" />
	<meta name="_csrf_header" th:content="${_csrf.headerName}" />
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" th:href="@{/css/member/find-pw.css}">
</head>

<body>
    <div class="container">
    	<div class="find-pw-box">
    		<h2>비밀번호 찾기</h2>
    		<form id="findPwForm">
    		
    			<!-- 각 입력 필드를  form-group으로 묶음 -->
    			<div class="form-group">
    				<label for="memberId">아이디</label>
    				<input type="text" id="memberId" name="memberId" required />
    			</div>
    			<div class="form-group">
    				<label for="memberName">이름</label>
    				<input type="text" id="memberName" name="memberName" required />
    			</div>
    			<div class="form-group">
    				<label for="memberEmail">이메일</label>
    				<input type="email" id="memberEmail" name="memberEmail" required />
    			</div>
    			
    			<!-- 버튼 그룹 -->
    			<div class="btn-group">
    				<button type="button" class="btn-cancel" onclick="window.location.href='/member/login'">취소</button>
    				<button type="submit" class="btn-submit">비밀번호 찾기</button>
    			</div>
    		</form>
    		
    		<!-- Ajax 요청 결과가 표시되는 곳 -->
    		<div id="result"></div>
    	</div>
    </div>

<script>
// CSRF 토큰 가져오기
const token = $("meta[name='_csrf']").attr("content");
const header = $("meta[name='_csrf_header']").attr("content");

// 비밀번호 찾기 폼 submit 이벤트
$("#findPwForm").submit(function(e){
	e.preventDefault();	// 기본 폼 제출 방지
	
	// 이전 결과 메시지 초기화
	$("#result").html("");
	
	// 폼데이터 가져오기
	// trim()으로 앞뒤 공백 제거
	const data = {
		memberId: $("#memberId").val().trim(),
		memberName: $("#memberName").val().trim(),
		memberEmail: $("#memberEmail").val().trim()
	};
	
	// 입력값 검증
	// 모든 칸이 비어있으면 Ajax 요청하지 않고 경고 표시
	if(!data.memberId || !data.memberName || !data.memberEmail){
		$("#result").css("color","red").html("모든 항목을 입력해주세요.");
		return;
	}
	
	// AJAX 요청
	// - type : POST
	// - url : /member/find-pw
	// - contentType : JSON
	// - beforeSend : CSRF 토큰 헤더 추가
	$.ajax({
		type: "POST",
		url: "/member/find-pw",
		contentType: "application/json",
		data: JSON.stringify(data),
		beforeSend: function(xhr){
			xhr.setRequestHeader(header, token);
		},
		success: function(res){
			
			// 서버 응답 처리
			// - success : 이메일로 임시 비밀번호 발송 성공
			// - fail : 오류 메시지 표시
			if(res.success){
				$("#result").css("color","green").html("임시 비밀번호가 이메일로 발송되었습니다. <br>5초 후 로그인 화면으로 이동합니다.");
				
				// 5초 후 자동으로 로그인 화면으로 이동
				setTimeout(function(){
					window.location.href = "/member/login";
				}, 5000);
			}else{
				$("#result").css("color","red").html(res.message);
			}
		},
		error: function(){
			$("#result").css("color","red").html("서버 요청 중 오류가 발생했습니다.");
		}
	})
});
</script>
</body>
</html>