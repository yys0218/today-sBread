<!--
******************************************
*  Created On : 2025. 8. 12.
*  File : rider-all-view.html
*******************************************
 -->

<html layout:decorate="~{rider/rider-layout1}">
    <!-- 페이지 전용 CSS 주입 -->
    <th:block layout:fragment="head-extra">
        <style>
            .rider_Info {
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                align-items: center; /* 세로 가운데 정렬 */
                padding: 8px 12px;
                border-bottom: 2px solid #000;
                background-color: #333; /* 어두운 배경 */
                color: #fff;
            }

            .info_id,
            .info_time {
                margin: 5px 10px;
                font-size: 15px;
                font-weight: 500;
                color: #fff; /* 글씨 흰색 */
            }

            .delivery_info {
                padding: 12px;
                font-weight: bold;
                background-color: #444; /* 어두운 배경 */
                border-radius: 8px;
                text-align: center;
                color: #fff;
                display: flex;
                flex-direction: row;
                justify-content: space-between;
            }

            /* 각 섹션 (금액/연락처/주소/메모) */
            .delivery_detail {
                padding: 15px;
                min-height: 490px;
                max-height: 490px;
                border-radius: 10px;
                background: #222; /* 다크 배경 */
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.6);
                color: #fff;
            }
            .delivery_title {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin: 12px 0;
                font-size: 14px;
            }
            .delivery_title span {
                font-weight: 600;
                color: #fff;
            }

            /* input, textarea */
            .custom-h-input {
                color: #eee;
                border: none;
                background: transparent;
                text-align: right;
                margin-right: 10px;
                width: 100%;
                pointer-events: none; /* 읽기전용 */
            }
            #delivery_address {
                padding: 6px 10px;
                width: 100%;
                text-align: right;
                max-width: 250px;
                font-size: 14px;
                line-height: 1.5;
                border-radius: 6px;
                background: rgba(0, 0, 0, 0);
                color: #fff;
                overflow-wrap: break-word; /* 긴 주소 줄바꿈 */
                white-space: pre-wrap; /* 줄바꿈 유지 */
            }

            /* 고객 메모 */
            .delivery_title.flex-column {
                flex-direction: column;
                align-items: flex-start;
            }
            .delivery_title.flex-column span {
                margin-bottom: 6px;
            }
            .delivery_title.flex-column .card {
                width: 100%;
                padding: 8px;
                background: #2a2a2a;
                color: #fff;
            }

            .order-box {
                background-color: #111; /* 아주 어두운 배경 */
                color: #fff; /* 글씨 흰색 */
                padding: 12px 16px;
                border-radius: 12px;
                word-break: break-word;
                font-size: 14px;
                line-height: 1.6;

                overflow-y: auto;
                margin-top: 6px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.6);
                width: 100%;
                max-height: 90px;
                overflow-y: auto;
                scrollbar-gutter: stable;
            }

            /* 부모 div */
            .delivery_title.flex-column > div {
                width: 100%;
            }
            .delivery_title > div {
                height: auto;
            }

            /* 주문 항목 */
            .order-box p {
                margin: 0 0 6px 0;
                padding-left: 8px;
                font-size: 14px;
                position: relative;
            }
            .order-box p:before {
                content: '•';
                position: absolute;
                left: 0;
                color: #ffcd39; /* 노란 포인트 */
                font-size: 14px;
            }
            .order-box p:last-child {
                margin-bottom: 0;
            }

            /* 스크롤바 */
            .order-box::-webkit-scrollbar {
                width: 10px;
            }
            .order-box::-webkit-scrollbar-thumb {
                background: #555;
                border-radius: 12px;
            }
            .order-box::-webkit-scrollbar-track {
                background: #222;
                border-radius: 12px;
            }

            /* 로그인/로그아웃 버튼 */
            a,
            .btn-sub,
            .custom-btn {
                color: #fff !important;
                background-color: #333 !important;
                border-radius: 6px;
                padding: 6px 12px;
                text-decoration: none;
                transition: background-color 0.2s ease;
            }
            a:hover,
            .btn-sub:hover,
            .custom-btn:hover {
                background-color: #555 !important;
                color: #fff !important;
            }

            .timeline {
                display: flex;
                justify-content: space-between;
                align-items: center;
                background: #111;
                padding: 10px 15px;
                border-radius: 10px;
                gap: 20px;
            }

            /* 각 단계 */
            .step {
                display: flex;
                flex-direction: column;
                align-items: center;
                position: relative;
            }

            /* 시간 */
            .step .time {
                font-size: 12px;
                color: #aaa;
                margin-bottom: 4px;
                min-height: 16px; /* 최소 높이 확보 */
                line-height: 16px; /* 빈 경우에도 공간 유지 */
            }

            /* 원형 표시 */
            .step .circle {
                width: 14px;
                height: 14px;
                border-radius: 50%;
                border: 2px solid #555;
                background: #111;
                position: relative;
            }

            /* 완료된 단계 (초록색) */
            .step.done .circle {
                background: #00c853;
                border-color: #00c853;
            }

            /* 현재 단계 (흰색) */
            .step.active .circle {
                background: #fff;
                border-color: #fff;
            }

            /* 텍스트 라벨 */
            .step .label {
                font-size: 13px;
                margin-top: 4px;
                color: #ddd;
            }

            /* 연결선 */
            .step:not(:last-child)::after {
                content: '';
                position: absolute;
                top: 21px;
                left: 50%;
                width: 100%;
                height: 2px;
                background: #555;
                z-index: -1;
            }

            /* 완료된 구간 선 */
            .step.done:not(:last-child)::after {
                background: #00c853;
            }

            .order-card {
                background: #1e1e1e;
                border: 1px solid #2c2c2c;
                color: #fff;
                border-radius: 10px;
                height: 120px;
                padding: 12px;
                margin: 10px 0;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
                transition: transform 0.2s ease, box-shadow 0.2s ease;
            }
            .order-card:hover {
                cursor: pointer;
                /* transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6); */
            }

            /* 헤더 */
            .order-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                font-size: 13px;
                padding-bottom: 4px;
                border-bottom: 1px solid #333;
                gap: 20px;
            }

            .order-no,
            .order-status {
                width: 100px;
            }

            .order-time {
                width: 150px;
            }

            .order-header-left {
                font-weight: bold;
                color: #ffcc00; /* 주문번호 강조 */
            }
            .order-header-left::before {
                content: '#';
                color: #ff2e63;
                margin-right: 4px;
            }
            .order-header-right {
                font-size: 12px;
                color: #bbb;
            }

            /* 바디 */
            .order-body {
                display: flex;
                justify-content: space-between; /* 좌-우 나눔 */
                flex-grow: 1;
                padding: 8px 0;
                font-size: 13px;
                border-left: 3px solid #444;
                padding-left: 10px;
            }
            .order-body > .d-flex:last-of-type {
                margin-right: 10px;
            }
            /* 왼쪽: 주문 정보 */
            .order-info {
                flex: 3;
            }
            .order-info .payment {
                font-weight: bold;
            }
            .order-no {
                font-weight: bold;
                font-size: 14px;
                color: #ffcc00; /* 눈에 띄는 노란색 */
                margin-right: 8px;
            }

            .order-time {
                font-size: 13px;
                color: #ccc; /* 흐린 회색 */
                margin-right: 8px;
            }

            .order-status {
                font-weight: bold;
                font-size: 13px;
                color: #4da6ff; /* 파란 계열 */
                background: rgba(77, 166, 255, 0);
                padding: 2px 6px;
                border-radius: 4px;
            }

            .order-status.대기 {
                color: #ffaa00;
                background: rgba(255, 170, 0, 0);
            }
            .order-status.요청 {
                color: #4da6ff;
                background: rgba(77, 166, 255, 0);
            }
            .order-status.완료 {
                color: #00cc66;
                background: rgba(0, 204, 102, 0);
            }

            .address {
                color: #ddd;
                font-size: 12px;
                margin-top: 4px;
                word-wrap: break-word;
                white-space: normal;
            }

            /* 오른쪽: 거리/금액 */
            .order-price {
                flex: 1;
                text-align: right;
                font-size: 15px;
                font-weight: bold;
                color: #00ff99;
                white-space: nowrap;
            }

            .distance {
                margin-right: 10px;
            }

            /* 푸터 */
            .order-footer {
                display: flex;
                justify-content: flex-end;
                border-top: 1px solid #333;
                padding-top: 6px;
            }

            /* 버튼 */
            .accept-btn {
                background: linear-gradient(135deg, #ff2e63, #ff5c8a);
                box-shadow: 0 4px 10px rgba(255, 46, 99, 0.4);
                border: none;
                border-radius: 6px;
                cursor: pointer;
                color: #fff;
                font-weight: bold;
                padding: 6px 14px;
                transition: transform 0.15s ease;
            }

            /* 버튼 */
            .accept-btn,
            .shop-btn,
            .pickup-btn,
            .delivery-btn,
            .complete-btn {
                background: linear-gradient(135deg, #ff2e63, #ff5c8a);
                box-shadow: 0 4px 10px rgba(255, 46, 99, 0.4);
                border: none;
                border-radius: 6px;
                cursor: pointer;
                color: #fff;
                font-weight: bold;
                padding: 6px 14px;
                transition: transform 0.15s ease;
            }

            /* 버튼 안에 내용이 없으면 자동 숨김 */
            .accept-btn:empty,
            .shop-btn:empty,
            .delivery-btn:empty,
            .complete-btn:empty,
            .pickup-btn:empty {
                display: none;
            }

            .accept-btn:hover,
            .shop-btn:hover,
            .delivery-btn:hover,
            .complete-btn:hover,
            .pickup-btn:hover {
                transform: scale(1.05);
                background: linear-gradient(135deg, #e02655, #ff2e63);
            }
            .active-card {
                border: 2px solid #e7e7e7 !important;
            }

            .end-text {
                color: #ffffff;
                margin: 20px 0px 10px 0px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .empty_list {
                color: #ffffff;
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .close_modal {
                display: flex;
                justify-content: end;
            }
            .close_modal > i {
                font-size: 20px;
                cursor: pointer;
            }

            /* 모달 레이어 */
            .modal_layer {
                position: fixed;
                top: 50vh;
                left: 50vw;
                transform: translate(-50%, -50%);
                z-index: 1010;
                display: none;

                min-width: 50vw;
                max-width: 80vw;
            }

            /* 모달 박스 */
            .modal_box {
                background: #2a2a2a;
                color: #eee;
                border-radius: 12px;
                padding: 20px;
                box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6);
                display: flex;
                flex-direction: column;
                box-sizing: border-box;
                max-height: 90vh;
                min-height: 90vh;
                overflow: hidden;
            }

            #map {
                width: 100%;
                height: 500px;
            }
        </style>
    </th:block>

    <!-- side_bar 영역 시작 -->
    <div layout:fragment="side_bar">
        <!-- rider의 정보 출력용 div-->
        <div>
            <div class="rider_Info">
                <div class="info_time">
                    <span class="timezone">
                        <span class="timezone_hour"></span>
                        :
                        <span class="timezone_min"></span>
                        :
                        <span class="timezone_sec"></span>
                    </span>
                </div>
                <div class="info_id">
                    <span th:text="|#${#authentication.principal.username} 님 |"></span>
                </div>
            </div>
            <div>
                <div class="delivery_info card mt-3">
                    <div class="step requested done">
                        <div class="time">00:00</div>
                        <div class="circle"></div>
                        <div class="label">요청</div>
                    </div>
                    <div class="step assigned active">
                        <div class="time">00:00</div>
                        <div class="circle"></div>
                        <div class="label">배차</div>
                    </div>
                    <div class="step pickup">
                        <div class="time">00:00</div>
                        <div class="circle"></div>
                        <div class="label">픽업</div>
                    </div>
                    <div class="step">
                        <div class="time">00:00</div>
                        <div class="circle"></div>
                        <div class="label">완료</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="delivery_detail card px-3 mt-3">
            <div class="delivery_title">
                <span>금액</span>
                <div class="d-flex">
                    <input type="text" name="orderPrice" id="orderPrice" class="custom-h-input order-price" />
                </div>
            </div>
            <div class="delivery_title">
                <span>고객연락처</span>
                <div class="d-flex">
                    <input type="text" name="orderPhone" id="orderPhone" class="custom-h-input" />
                </div>
            </div>
            <div class="delivery_title">
                <span>배달주소</span>
                <div id="delivery_address"></div>
            </div>
            <div class="delivery_title flex-column">
                <span>고객 메모</span>
                <div>
                    <div class="order-box order-request"></div>
                </div>
            </div>
            <div class="delivery_title flex-column">
                <span>주문 내역</span>
                <div>
                    <div class="order-box order-details"></div>
                </div>
            </div>
        </div>

        <script>
            // jQuery가 로드된 뒤 실행
            $(function () {
                function tickOne($box) {
                    const tz = $box.data('tz') || Intl.DateTimeFormat().resolvedOptions().timeZone;
                    const fmt = new Intl.DateTimeFormat('ko-KR', {
                        timeZone: tz,
                        hour12: false,
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit',
                    });
                    const parts = fmt.formatToParts(new Date());
                    const map = {};
                    parts.forEach((p) => (map[p.type] = p.value));

                    $box.find('.timezone_hour').text(map.hour);
                    $box.find('.timezone_min').text(map.minute);
                    $box.find('.timezone_sec').text(map.second);
                }

                function tickAll() {
                    $('.timezone').each(function () {
                        tickOne($(this));
                    });
                }

                tickAll(); // 즉시 1회
                setInterval(tickAll, 1000); // 1초마다 갱신
            });
        </script>
    </div>
    <!-- side_bar 영역 끝 -->

    <!-- content 영역 시작 -->
    <div layout:fragment="content" class="content-start" data-order-type="accept">
        <th:block th:replace="~{rider/orderFragment :: orderList}"></th:block>
        <th:block th:replace="~{rider/deliveryModalFragment :: deliveryModal}"></th:block>

        <script>
            $('.nav_item').removeClass('active');
            $('.nav_item').eq(2).addClass('active');

            // const dimmed = $('.dimmed');
            // const modal = $('.modal_layer');
            // const closeTopBtn = $('.close_modal').children();
            // const closeBottomBtn = $('.close-btn');

            // function closeDeliveryModal() {
            //     dimmed.hide();
            //     modal.hide();
            // }

            // // 모달 배경 클릭 시 닫기
            // dimmed.on('click', function () {
            //     closeDeliveryModal();
            // });

            // // 모달 ESC 키 닫기
            // $(document).on('keydown', function (e) {
            //     if (e.key === 'Escape') {
            //         closeDeliveryModal();
            //     }
            // });

            // 아래와 같이 옵션을 입력하지 않아도 된다

            // $(document).on('click', '.detail-btn', function () {
            //     dimmed.show();
            //     modal.show();
            //     let latitude = $(this).closest('.order-card').find('.distance').data('lat');
            //     let longitude = $(this).closest('.order-card').find('.distance').data('lng');
            //     let shopName = $(this).closest('.order-card').find('.distance').data('shopName');
            //     // 지도를 표시할 div와  지도 옵션으로  지도를 생성합니다
            //     initMap(latitude, longitude, shopName);
            // });

            // //
            // function initMap(latitude, longitude, shopName) {
            //     navigator.geolocation.getCurrentPosition(function (pos) {
            //         const riderLat = pos.coords.latitude;
            //         const riderLng = pos.coords.longitude;
            //         // 1. 컨테이너와 옵션 먼저 정의
            //         var mapContainer = document.getElementById('map');
            //         var mapOption = {
            //             center: new kakao.maps.LatLng(latitude, longitude), // 중심 좌표
            //             level: 1, // 확대 레벨
            //         };

            //         // 2. 지도 객체 생성
            //         var map = new kakao.maps.Map(mapContainer, mapOption);

            //         // 3. 줌 컨트롤 추가
            //         var zoomControl = new kakao.maps.ZoomControl();
            //         map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

            //         // 4. 오버레이 제거 후 교통정보 추가
            //         var mapTypes = {
            //             traffic: kakao.maps.MapTypeId.TRAFFIC,
            //             roadview: kakao.maps.MapTypeId.ROADVIEW,
            //             terrain: kakao.maps.MapTypeId.TERRAIN,
            //             bicycle: kakao.maps.MapTypeId.BICYCLE,
            //         };

            //         for (var type in mapTypes) {
            //             map.removeOverlayMapTypeId(mapTypes[type]);
            //         }
            //         map.addOverlayMapTypeId(mapTypes.traffic);

            //         var imageSrc = '/image/rider/shopIcon.png', // 마커이미지의 주소입니다
            //             imageSize = new kakao.maps.Size(64, 69), // 마커이미지의 크기입니다
            //             imageOption = { offset: new kakao.maps.Point(27, 69) }; // 마커이미지의 옵션입니다. 마커의 좌표와 일치시킬 이미지 안에서의 좌표를 설정합니다.

            //         // 마커의 이미지정보를 가지고 있는 마커이미지를 생성합니다
            //         var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption),
            //             markerPosition = new kakao.maps.LatLng(latitude, longitude); // 마커가 표시될 위치입니다

            //         // 마커를 표시할 위치와 title 객체 배열입니다
            //         var positions = [
            //             {
            //                 title: '가게',
            //                 latlng: new kakao.maps.LatLng(latitude, longitude),
            //                 img: '/image/rider/shopIcon.png',
            //             },
            //             {
            //                 title: '라이더',
            //                 latlng: new kakao.maps.LatLng(riderLat, riderLng),
            //                 img: '/image/rider/riderIcon.png',
            //             },
            //         ];

            //         // positions 배열 돌면서 마커 생성
            //         positions.forEach(function (pos) {
            //             var imageSize = new kakao.maps.Size(64, 69); // 마커 크기
            //             var markerImage = new kakao.maps.MarkerImage(pos.img, imageSize);

            //             new kakao.maps.Marker({
            //                 map: map, // 표시할 지도
            //                 position: pos.latlng, // 좌표
            //                 title: pos.title, // 마우스 오버 시 표시되는 타이틀
            //                 image: markerImage, // 이미지
            //             });
            //         });

            //         // 가게/라이더 좌표 배열
            //         var bounds = new kakao.maps.LatLngBounds();

            //         positions.forEach(function (pos) {
            //             bounds.extend(pos.latlng);
            //         });

            //         // 지도 영역을 bounds로 맞춤
            //         map.setBounds(bounds);

            //         // (선택) 드래그 제한 → 지도 바깥으로 안 나가게
            //         kakao.maps.event.addListener(map, 'dragend', function () {
            //             if (!bounds.contain(map.getCenter())) {
            //                 map.setBounds(bounds); // 다시 지정
            //             }
            //         });

            //         // 맵에 드레그 끄기
            //         map.setDraggable(false);
            //         return map; // 필요하다면 map 객체 반환
            //     });
            // }

            // $(document).on('click', '.detail-btn', function () {
            //     dimmed.show();
            //     modal.show();
            //     let latitude = parseFloat($(this).closest('.order-card').find('.distance').data('lat'));
            //     let longitude = parseFloat($(this).closest('.order-card').find('.distance').data('lng'));
            //     // 지도를 표시할 div와  지도 옵션으로  지도를 생성합니다

            //     initMap(latitude, longitude);
            // });

            // function initMap(shopLat, shopLng) {
            //     console.log('shopLat : ' + shopLat);
            //     console.log('shopLng : ' + shopLng);

            //     navigator.geolocation.getCurrentPosition(function (pos) {
            //         const riderLat = pos.coords.latitude;
            //         const riderLng = pos.coords.longitude;
            //         console.log('pos 실행');

            //         // 1. 지도 컨테이너 + 옵션
            //         var mapContainer = document.getElementById('map');
            //         var mapOption = {
            //             center: new kakao.maps.LatLng(shopLat, shopLng), // 초기 중심은 상점
            //             level: 4, // 확대 레벨 (적당히 두 점 다 보이게)
            //         };

            //         // 2. 지도 객체 생성
            //         var map = new kakao.maps.Map(mapContainer, mapOption);

            //         // 3. 표시할 마커 데이터
            //         var positions = [
            //             { title: '가게', latlng: new kakao.maps.LatLng(shopLat, shopLng), img: '/image/rider/shopIcon.png' },
            //             { title: '라이더', latlng: new kakao.maps.LatLng(riderLat, riderLng), img: '/image/rider/riderIcon.png' },
            //         ];

            //         // 4. 마커 생성 (커스텀 아이콘)
            //         positions.forEach(function (pos) {
            //             var markerImage = new kakao.maps.MarkerImage(
            //                 pos.img,
            //                 new kakao.maps.Size(48, 52), // 아이콘 크기 (적당히 조정)
            //                 { offset: new kakao.maps.Point(24, 52) } // 기준 좌표 (중앙 하단)
            //             );

            //             new kakao.maps.Marker({
            //                 map: map,
            //                 position: pos.latlng,
            //                 title: pos.title,
            //                 image: markerImage,
            //             });
            //         });

            //         // 5. 두 좌표 기준으로 지도 범위 자동 맞춤
            //         var bounds = new kakao.maps.LatLngBounds();
            //         positions.forEach(function (pos) {
            //             bounds.extend(pos.latlng);
            //         });
            //         map.setBounds(bounds);

            //         // 6. 불필요한 기능 비활성화 (최적화 포인트)
            //         map.setDraggable(false); // 드래그 불가
            //         map.setZoomable(false); // 줌 불가
            //         console.log('실행');
            //     });
            // }
            // jquery 셀럭터로 합치기
            // closeBottomBtn , closeTopBtn 두개 합쳐서 이벤트 함수 실행
        </script>
    </div>

    <!-- content 영역 끝 -->
</html>

<!-- IT&BIZ-->
