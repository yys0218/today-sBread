<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{admin/adminLayout}">

<head>
  <link rel="stylesheet" th:href="@{/css/admin/report.css}">
</head>
<div layout:fragment="content">
  <h2 class="il-title">신고 관리</h2>

  <form id="reportSortForm" th:action="@{/admin/board/report/list}" method="get">
    <!-- hidden inputs -->
    <input type="hidden" name="reportType" id="reportType" th:value="${type}" />
    <input type="hidden" name="reportStatus" id="reportStatus" th:value="${status}" />
    <input type="hidden" name="sortField" id="reportSortField" th:value="${sortField}" />
    <input type="hidden" name="sortDir" id="reportSortDir" th:value="${sortDir}" />

    <!-- 신고유형 카테고리 -->
    <div class="il-tabs">
      <button type="button" onclick="setReportFilterSort('reportType', -1)"
        th:classappend="${type==-1} ? ' active ' + ${sortDir} : ''">전체</button>
      <button type="button" onclick="setReportFilterSort('reportType', 0)"
        th:classappend="${type==0} ? ' active ' + ${sortDir} : ''">회원 관련 신고</button>
      <button type="button" onclick="setReportFilterSort('reportType', 1)"
        th:classappend="${type==1} ? ' active ' + ${sortDir} : ''">매장 관련 신고</button>
    </div>

    <!-- 상태 필터 -->
    <div class="il-tabs">
      <button type="button" onclick="setReportFilterSort('reportStatus', -1)"
        th:classappend="${status==-1} ? ' active ' + ${sortDir} : ''">전체</button>
      <button type="button" onclick="setReportFilterSort('reportStatus', 0)"
        th:classappend="${status==0} ? ' active ' + ${sortDir} : ''">미답변</button>
      <button type="button" onclick="setReportFilterSort('reportStatus', 1)"
        th:classappend="${status==1} ? ' active ' + ${sortDir} : ''">답변완료</button>
    </div>
  </form>

  <!-- 글 출력 갯수 선택 -->
  <div class="il-filter box">
    <form method="get" th:action="@{/admin/board/report/list}">
      <input type="hidden" name="status" th:value="${status}" />
      <input type="hidden" name="type" th:value="${type}" />
      <input type="hidden" name="sortField" th:value="${sortField}" />
      <input type="hidden" name="sortDir" th:value="${sortDir}" />

      <label for="size">페이지당 글 수:</label>
      <select name="size" id="size" onchange="this.form.submit()">
        <option th:value="10" th:selected="${size==10}">10개</option>
        <option th:value="20" th:selected="${size==20}">20개</option>
        <option th:value="30" th:selected="${size==30}">30개</option>
      </select>
    </form>
  </div>

  <!-- 목록 테이블 -->
  <table class="il-table">
    <thead>
      <tr>
        <th>번호</th>
        <th>유형</th>
        <th>상태</th>
        <th>제목</th>
        <th>신고자</th>
        <th>대상</th>
        <th>작성일</th>
      </tr>
    </thead>
    <tbody>
      <tr th:each="r, loop : ${paging.content}"
        th:onclick="|location.href='@{/admin/board/report/detail/{reportNo}(reportNo=${r.reportNo}, page=${page}, status=${status}, type=${type}, size=${size}, sortField=${sortField}, sortDir=${sortDir})}'|"
        style="cursor:pointer;">
        <td th:text="${paging.getTotalElements - (paging.number * paging.size) - loop.index}"></td>
        <td>
          <span th:if="${r.reportType==0}">회원 관련 신고</span>
          <span th:if="${r.reportType==1}">매장 관련 신고</span>
        </td>
        <td>
          <span class="il-status il-status--wait" th:if="${r.reportStatus==0}">미답변</span>
          <span class="il-status il-status--done" th:if="${r.reportStatus == 1 or r.reportStatus == 2}">답변완료</span>
        </td>
        <td th:text="${r.reportTitle}"></td>
        <td th:text="${r.member.memberNick}"></td>
        <td th:text="${r.reportRef}"></td>
        <td th:text="${#temporals.format(r.reportAt,'yyyy-MM-dd')}"></td>
      </tr>
    </tbody>
  </table>

  <!-- 페이징 처리 -->
  <div th:if="${!paging.isEmpty()}">
    <ul class="pagination justify-content-center">
      <span class="page-item" th:if="${paging.hasPrevious()}">
        <a class="page-link"
          th:href="@{/admin/board/report/list(page=${paging.number-1}, status=${status}, type=${type}, size=${size}, sortField=${sortField}, sortDir=${sortDir})}">
          <span>이전</span>
        </a>
      </span>
      <span th:each="page:${#numbers.sequence(0, paging.totalPages-1)}"
        th:if="${page >= paging.number-5 and page <= paging.number+5}"
        th:classappend="${page==paging.number} ? 'active'" class="page-item">
        <a th:text="${page+1}" class="page-link"
          th:href="@{/admin/board/report/list(page=${page}, status=${status}, type=${type}, size=${size}, sortField=${sortField}, sortDir=${sortDir})}"></a>
      </span>
      <span class="page-item" th:if="${paging.hasNext()}">
        <a class="page-link"
          th:href="@{/admin/board/report/list(page=${paging.number+1}, status=${status}, type=${type}, size=${size}, sortField=${sortField}, sortDir=${sortDir})}">
          <span>다음</span>
        </a>
      </span>
    </ul>
  </div>
  <!-- 페이징 처리 끝 -->
</div>
<th:block layout:fragment="script">
  <script th:src="@{/js/admin/admin.js}"></script>
  <script>
    // 필터 + 정렬 토글
    function setReportFilterSort(field, value) {
      const form = document.getElementById("reportSortForm");
      const fieldInput = document.getElementById("reportSortField");
      const dirInput = document.getElementById("reportSortDir");

      // 필터 값 세팅
      document.getElementById(field).value = value;

      // 정렬 기준: 날짜(reportAt)로 고정
      fieldInput.value = "reportAt";

      // 정렬 방향 토글
      const currentDir = dirInput.value || "desc";
      dirInput.value = (currentDir === "desc") ? "asc" : "desc";

      form.submit();
    }
  </script>
</th:block>

</html>
